#!/bin/bash

# Define the command version
VERSION="v0.1.0"

# Function to display command version
show_version() {
    echo "internsctl version $VERSION"
}

# Function to create a new user
create_user() {
    if [ -z "$1" ]; then
        echo "Error: Username not provided. Usage: internsctl user create <username>"
        exit 1
    fi

    username="$1"

    # Check if the user already exists
    if id "$username" &>/dev/null; then
        echo "Error: User '$username' already exists."
        exit 1
    fi

    # Create the user with a home directory
    useradd -m "$username"

    echo "User '$username' created successfully."
}

# Function to list all users
list_users() {
    cut -d: -f1 /etc/passwd
}

# Function to list users with sudo permissions
list_sudo_users() {
    getent group sudo | cut -d: -f4 | tr ',' '\n'
}

# Process command line options
case "$1" in
    --help)
        echo "Usage: internsctl [options]"
        echo "Options:"
        echo "  --help              Display help and examples"
        echo "  --version           Display command version"
        echo "  user create <username>       Create a new user"
        echo "  user list                    List all users"
        echo "  user list --sudo-only       List users with sudo permissions"
        ;;
    --version)
        show_version
        ;;
    user)
        case "$2" in
            create)
                create_user "$3"
                ;;
            list)
                if [ "$3" == "--sudo-only" ]; then
                    list_sudo_users
                else
                    list_users
                fi
                ;;
            *)
                echo "Error: Unknown user subcommand. Use 'internsctl --help' for usage."
                exit 1
                ;;
        esac
        ;;
    *)
        echo "Error: Unknown option. Use 'internsctl --help' for usage."
        exit 1
        ;;
esac

exit 0
